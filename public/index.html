<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TIC TAC TOE</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323:wght@400&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #030303;
      --x: #ff4d6d;
      --o: #4dffb8;
      --accent: #ffe94d;
      --text: #e8e8f0;
      --dim: rgba(255,255,255,0.3);
      --border: rgba(255,255,255,0.08);
      --border-hi: rgba(255,255,255,0.15);
      --panel: rgba(255,255,255,0.02);
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    html,body { width:100%; height:100%; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Press Start 2P', monospace;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ BACKGROUND ‚îÄ‚îÄ */
    .bg-gradient {
      position: fixed; inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 20% 40%, rgba(99,102,241,0.05) 0%, transparent 60%),
        radial-gradient(ellipse 60% 50% at 80% 70%, rgba(244,63,94,0.05) 0%, transparent 60%);
      pointer-events: none; z-index: 0;
    }
    .bg-vignette {
      position: fixed; inset: 0;
      background: linear-gradient(to bottom, rgba(3,3,3,0.8) 0%, transparent 20%, transparent 80%, rgba(3,3,3,0.8) 100%);
      pointer-events: none; z-index: 2;
    }
    .shapes { position: fixed; inset: 0; overflow: hidden; pointer-events: none; z-index: 1; }
    .shape {
      position: absolute; border-radius: 9999px;
      border: 2px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(2px);
      box-shadow: 0 8px 32px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(255,255,255,0.04);
      opacity: 0;
      animation: slideIn var(--slide-dur,2.4s) var(--delay,0s) cubic-bezier(0.23,0.86,0.39,0.96) forwards,
                 floatY  var(--float-dur,12s) calc(var(--delay,0s) + var(--slide-dur,2.4s)) ease-in-out infinite;
    }
    @keyframes slideIn {
      from { opacity:0; transform:translateY(-160px) rotate(var(--rot-start)); }
      to   { opacity:1; transform:translateY(0px)    rotate(var(--rot-end)); }
    }
    @keyframes floatY {
      0%,100% { transform:translateY(0px)  rotate(var(--rot-end)); }
      50%      { transform:translateY(18px) rotate(var(--rot-end)); }
    }
    .shape-1 { width:600px;height:140px;left:-5%;top:20%;background:linear-gradient(to right,rgba(99,102,241,0.15),transparent);--rot-start:-3deg;--rot-end:12deg;--delay:.3s;--float-dur:12s; }
    .shape-2 { width:500px;height:120px;right:0%;top:75%;background:linear-gradient(to right,rgba(244,63,94,0.15),transparent);--rot-start:-30deg;--rot-end:-15deg;--delay:.5s;--float-dur:14s; }
    .shape-3 { width:300px;height:80px;left:10%;bottom:10%;background:linear-gradient(to right,rgba(139,92,246,0.15),transparent);--rot-start:-23deg;--rot-end:-8deg;--delay:.4s;--float-dur:10s; }
    .shape-4 { width:200px;height:60px;right:20%;top:15%;background:linear-gradient(to right,rgba(245,158,11,0.15),transparent);--rot-start:5deg;--rot-end:20deg;--delay:.6s;--float-dur:9s; }
    .shape-5 { width:150px;height:40px;left:25%;top:10%;background:linear-gradient(to right,rgba(6,182,212,0.15),transparent);--rot-start:-40deg;--rot-end:-25deg;--delay:.7s;--float-dur:11s; }

    /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
    .screen { display:none; width:100%; max-width:460px; position:relative; z-index:10; animation: fadeUp .6s both; }
    .screen.active { display:block; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

    /* ‚îÄ‚îÄ SHARED COMPONENTS ‚îÄ‚îÄ */
    .logo { text-align:center; margin-bottom:32px; }
    .logo-title {
      font-size: clamp(18px,4vw,28px); letter-spacing:4px;
      background: linear-gradient(to bottom,#fff,rgba(255,255,255,0.7));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }
    .logo-sub {
      font-size: clamp(10px,2vw,14px); letter-spacing:3px; margin-top:6px;
      background: linear-gradient(to right,#a5b4fc,rgba(255,255,255,0.85),#fda4af);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }

    .badge {
      display:inline-flex; align-items:center; gap:8px;
      padding:4px 14px; border-radius:9999px;
      background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08);
    }
    .badge-dot { width:6px;height:6px;border-radius:50%;background:rgba(244,63,94,0.8); }
    .badge span { font-size:7px; color:rgba(255,255,255,0.5); letter-spacing:3px; }

    .card {
      background: var(--panel); border:1px solid var(--border);
      padding:20px; border-radius:2px; margin-bottom:10px;
    }

    .label { font-size:7px; color:var(--dim); letter-spacing:2px; margin-bottom:10px; }

    .btn {
      width:100%; padding:14px 10px;
      font-family:'Press Start 2P',monospace; font-size:8px; letter-spacing:1px;
      cursor:pointer; border:1px solid var(--border);
      background:var(--panel); color:rgba(255,255,255,0.5);
      transition:all .2s; text-transform:uppercase; border-radius:2px;
      margin-bottom:8px;
    }
    .btn:last-child { margin-bottom:0; }
    .btn:hover { border-color:rgba(255,255,255,0.2); color:rgba(255,255,255,0.9); background:rgba(255,255,255,0.04); }
    .btn:active { transform:scale(0.97); }
    .btn.green { border-color:rgba(77,255,184,0.3); color:rgba(77,255,184,0.7); }
    .btn.green:hover { background:rgba(77,255,184,0.06); border-color:rgba(77,255,184,0.5); color:rgba(77,255,184,1); box-shadow:0 0 16px rgba(77,255,184,0.1); }
    .btn.red { border-color:rgba(255,77,109,0.3); color:rgba(255,77,109,0.7); }
    .btn.red:hover { background:rgba(255,77,109,0.06); border-color:rgba(255,77,109,0.5); color:rgba(255,77,109,1); }
    .btn.accent { border-color:rgba(255,233,77,0.3); color:rgba(255,233,77,0.8); }
    .btn.accent:hover { background:rgba(255,233,77,0.06); border-color:rgba(255,233,77,0.5); color:rgba(255,233,77,1); }
    .btn:disabled { opacity:0.3; cursor:not-allowed; transform:none; }

    .input {
      width:100%; padding:12px 14px;
      font-family:'Press Start 2P',monospace; font-size:11px; letter-spacing:4px;
      background:rgba(255,255,255,0.03); border:1px solid var(--border);
      color:var(--text); border-radius:2px; outline:none; text-transform:uppercase;
      transition:border-color .2s; text-align:center;
    }
    .input:focus { border-color:rgba(255,255,255,0.2); }
    .input::placeholder { color:rgba(255,255,255,0.15); letter-spacing:3px; }

    .error { font-size:7px; color:rgba(255,77,109,0.8); text-align:center; margin-top:8px; min-height:14px; letter-spacing:1px; }
    .divider { border:none; border-top:1px solid var(--border); margin:12px 0; }

    /* ‚îÄ‚îÄ SYMBOL PICKER ‚îÄ‚îÄ */
    .symbol-picker { display:flex; gap:8px; }
    .sym-btn {
      flex:1; padding:16px; font-family:'Press Start 2P',monospace; font-size:20px;
      cursor:pointer; border:1px solid var(--border); background:var(--panel);
      border-radius:2px; transition:all .2s;
    }
    .sym-btn.x { color:var(--x); }
    .sym-btn.x:hover, .sym-btn.x.selected { border-color:rgba(255,77,109,0.5); background:rgba(255,77,109,0.08); box-shadow:0 0 20px rgba(255,77,109,0.1); }
    .sym-btn.o { color:var(--o); }
    .sym-btn.o:hover, .sym-btn.o.selected { border-color:rgba(77,255,184,0.5); background:rgba(77,255,184,0.08); box-shadow:0 0 20px rgba(77,255,184,0.1); }

    /* ‚îÄ‚îÄ ROOM CODE DISPLAY ‚îÄ‚îÄ */
    .room-code-box {
      background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.12);
      padding:16px; text-align:center; border-radius:2px; margin-bottom:10px;
    }
    .room-code-label { font-size:7px; color:var(--dim); letter-spacing:3px; margin-bottom:10px; }
    .room-code {
      font-size:clamp(28px,8vw,42px); letter-spacing:10px;
      background:linear-gradient(to right,#a5b4fc,#fff,#fda4af);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      font-family:'VT323',monospace;
    }
    .room-code-hint { font-size:7px; color:rgba(255,255,255,0.2); margin-top:8px; letter-spacing:1px; }

    /* ‚îÄ‚îÄ WAITING SCREEN ‚îÄ‚îÄ */
    .waiting-anim { text-align:center; padding:20px 0; }
    .waiting-dots span {
      display:inline-block; width:8px; height:8px; border-radius:50%;
      background:rgba(255,255,255,0.3); margin:0 4px;
      animation:dotPulse 1.4s ease-in-out infinite;
    }
    .waiting-dots span:nth-child(2) { animation-delay:.2s; }
    .waiting-dots span:nth-child(3) { animation-delay:.4s; }
    @keyframes dotPulse {
      0%,80%,100%{transform:scale(1);opacity:.3}
      40%{transform:scale(1.4);opacity:1}
    }

    /* ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ */
    .game-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
    .game-code-pill {
      font-size:7px; color:rgba(255,255,255,0.3); letter-spacing:2px;
      background:rgba(255,255,255,0.03); border:1px solid var(--border);
      padding:4px 10px; border-radius:9999px;
    }
    .conn-pill {
      display:flex; align-items:center; gap:6px;
      font-size:7px; letter-spacing:2px;
      background:rgba(255,255,255,0.03); border:1px solid var(--border);
      padding:4px 10px; border-radius:9999px;
    }
    .conn-dot { width:6px;height:6px;border-radius:50%;transition:background .3s; }

    .scores { display:flex; gap:6px; margin-bottom:12px; }
    .score-card {
      flex:1; background:var(--panel); border:1px solid var(--border);
      padding:10px 8px; text-align:center; position:relative; border-radius:2px; transition:all .3s;
    }
    .score-card.active-x { border-color:rgba(255,77,109,0.4); box-shadow:0 0 20px rgba(255,77,109,0.1); }
    .score-card.active-o { border-color:rgba(77,255,184,0.4); box-shadow:0 0 20px rgba(77,255,184,0.1); }
    .score-card.mine { border-color:rgba(255,233,77,0.2); }
    .score-label { font-size:6px; color:var(--dim); letter-spacing:2px; margin-bottom:4px; }
    .score-player { font-size:12px; margin-bottom:3px; }
    .score-player.x { color:var(--x); text-shadow:0 0 14px rgba(255,77,109,0.5); }
    .score-player.o { color:var(--o); text-shadow:0 0 14px rgba(77,255,184,0.5); }
    .score-player.draw { color:rgba(255,255,255,0.4); }
    .score-num { font-size:26px; font-family:'VT323',monospace; color:rgba(255,255,255,0.85); }
    .turn-arrow { position:absolute;top:4px;right:6px;font-size:7px;color:rgba(255,255,255,0.4);animation:blink 1s infinite; }
    @keyframes blink{0%,100%{opacity:1}50%{opacity:0}}

    .status {
      background:var(--panel); border:1px solid var(--border);
      padding:10px 14px; text-align:center; font-size:8px; letter-spacing:2px;
      margin-bottom:10px; min-height:34px; display:flex; align-items:center;
      justify-content:center; gap:6px; transition:all .3s; border-radius:2px;
    }
    .status.win { border-color:rgba(255,233,77,0.3); color:rgba(255,233,77,0.9); box-shadow:0 0 24px rgba(255,233,77,0.08); }
    .status.draw { border-color:rgba(255,255,255,0.12); color:rgba(255,255,255,0.35); }
    .status.warn { border-color:rgba(255,165,0,0.3); color:rgba(255,165,0,0.8); }
    .status .pt { padding:2px 6px; font-size:8px; }
    .status .pt.x { color:var(--x); }
    .status .pt.o { color:var(--o); }

    .grid { display:grid; grid-template-columns:repeat(3,1fr); gap:3px; margin-bottom:10px; aspect-ratio:1; }
    .cell {
      background:rgba(255,255,255,0.02); border:1px solid var(--border);
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      font-size:clamp(26px,7vw,48px); font-family:'Press Start 2P',monospace;
      transition:background .2s,border-color .2s,transform .05s; user-select:none; border-radius:2px;
    }
    .cell:hover:not(.taken):not(.over):not(.locked) { background:rgba(255,255,255,0.05); border-color:rgba(255,255,255,0.14); }
    .cell:active:not(.taken):not(.over):not(.locked) { transform:scale(0.96); }
    .cell.locked { cursor:not-allowed; }
    .cell.x-cell { color:var(--x); text-shadow:0 0 20px rgba(255,77,109,0.5); }
    .cell.o-cell { color:var(--o); text-shadow:0 0 20px rgba(77,255,184,0.5); }
    .cell.taken,.cell.over { cursor:default; }
    .cell.winning { background:rgba(255,233,77,0.06); border-color:rgba(255,233,77,0.35)!important; animation:winPulse 1s ease-in-out infinite alternate; }
    @keyframes winPulse{from{box-shadow:inset 0 0 10px rgba(255,233,77,0.1)}to{box-shadow:inset 0 0 24px rgba(255,233,77,0.2),0 0 16px rgba(255,233,77,0.08)}}
    .cell-content { display:inline-block; }
    .cell.x-cell .cell-content,.cell.o-cell .cell-content { animation:popIn .2s cubic-bezier(0.34,1.56,0.64,1); }
    @keyframes popIn{0%{transform:scale(0) rotate(-15deg);opacity:0}100%{transform:scale(1) rotate(0deg);opacity:1}}

    .btn-row { display:flex; gap:6px; }
    .btn-row .btn { margin-bottom:0; }

    .disconnect-bar {
      display:none; background:rgba(255,120,0,0.08); border:1px solid rgba(255,120,0,0.25);
      padding:10px; text-align:center; font-size:7px; color:rgba(255,165,0,0.8);
      letter-spacing:1px; border-radius:2px; margin-bottom:8px;
    }
    .disconnect-bar.visible { display:block; }
    #countdown { color:rgba(255,233,77,0.9); }
  </style>
</head>
<body>

  <div class="bg-gradient"></div>
  <div class="shapes">
    <div class="shape shape-1"></div><div class="shape shape-2"></div>
    <div class="shape shape-3"></div><div class="shape shape-4"></div>
    <div class="shape shape-5"></div>
  </div>
  <div class="bg-vignette"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- SCREEN 1: HOME                                 -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen active" id="screen-home">
    <div class="logo">
      <div class="logo-title">TIC TAC TOE</div>
      <div class="logo-sub">MULTIPLAYER</div>
    </div>

    <button class="btn green" onclick="showScreen('screen-create')">‚ñ∂ CREATE ROOM</button>
    <button class="btn" onclick="showScreen('screen-join')">‚å® JOIN ROOM</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- SCREEN 2: CREATE ROOM                          -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="screen-create">
    <div class="logo">
      <div class="logo-title">CREATE ROOM</div>
      <div class="logo-sub">SYMBOL ASSIGNED RANDOMLY</div>
    </div>

    <button class="btn green" onclick="createRoom()">‚ñ∂ CREATE ROOM</button>
    <button class="btn" onclick="showScreen('screen-home')">‚Üê BACK</button>
    <div class="error" id="create-error"></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- SCREEN 3: WAITING FOR OPPONENT                 -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="screen-waiting">
    <div class="logo">
      <div class="logo-title">ROOM CREATED</div>
    </div>

    <div class="room-code-box">
      <div class="room-code-label">SHARE THIS CODE</div>
      <div class="room-code" id="display-code">????</div>
      <div class="room-code-hint">SEND THIS TO YOUR OPPONENT</div>
    </div>

    <div class="card">
      <div style="text-align:center;">
        <div class="label" style="margin-bottom:6px;">YOU ARE PLAYING AS</div>
        <div id="assigned-symbol" style="font-size:36px;margin-bottom:16px;"></div>
        <div class="label" style="margin-bottom:14px;">WAITING FOR OPPONENT</div>
        <div class="waiting-anim">
          <div class="waiting-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
      </div>
    </div>

    <button class="btn red" onclick="leaveRoom()">‚úï CANCEL</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- SCREEN 4: JOIN ROOM                            -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="screen-join">
    <div class="logo">
      <div class="logo-title">JOIN ROOM</div>
    </div>

    <div class="card">
      <div class="label">ENTER ROOM CODE</div>
      <input class="input" id="join-code" maxlength="4" placeholder="XXXX"
             oninput="this.value=this.value.toUpperCase()"
             onkeydown="if(event.key==='Enter') joinRoom()"/>
    </div>

    <button class="btn green" onclick="joinRoom()">‚ñ∂ JOIN GAME</button>
    <button class="btn" onclick="showScreen('screen-home')">‚Üê BACK</button>
    <div class="error" id="join-error"></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- SCREEN 5: GAME                                 -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="screen-game">

    <div class="game-header">
      <div class="game-code-pill">ROOM: <span id="game-room-code">????</span></div>
      <div class="conn-pill">
        <div class="conn-dot" id="conn-dot" style="background:rgba(255,77,109,0.8)"></div>
        <span id="conn-label">CONNECTING</span>
      </div>
    </div>

    <div class="disconnect-bar" id="disconnect-bar">
      ‚ö† OPPONENT DISCONNECTED ‚Äî WAITING <span id="countdown">60</span>s
    </div>

    <div class="scores">
      <div class="score-card" id="card-x">
        <div class="score-label">PLAYER X</div>
        <div class="score-player x">X</div>
        <div class="score-num" id="score-x">0</div>
      </div>
      <div class="score-card" id="card-draw">
        <div class="score-label">DRAWS</div>
        <div class="score-player draw">‚Äî</div>
        <div class="score-num" id="score-draws">0</div>
      </div>
      <div class="score-card" id="card-o">
        <div class="score-label">PLAYER O</div>
        <div class="score-player o">O</div>
        <div class="score-num" id="score-o">0</div>
      </div>
    </div>

    <div class="status" id="status">CONNECTING...</div>
    <div class="grid" id="grid"></div>

    <div class="btn-row" style="margin-bottom:8px;">
      <button class="btn green" onclick="send({type:'reset'})">‚ñ∂ NEW ROUND</button>
      <button class="btn" onclick="send({type:'new'})">‚Ü∫ RESET ALL</button>
    </div>
    <button class="btn red" onclick="leaveRoom()">‚úï LEAVE ROOM</button>

    <div class="error" id="game-error"></div>
  </div>

  <script>
    // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let ws = null;
    let mySymbol = null;
    let roomCode = null;
    let gameState = null;
    let selectedSymbol = 'X';
    let countdownTimer = null;
    let countdownVal = 60;

    // ‚îÄ‚îÄ Screen management ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => {
        s.classList.remove('active');
        // reset animation
        s.style.animation = 'none';
      });
      const el = document.getElementById(id);
      el.classList.add('active');
      el.style.animation = '';
      void el.offsetWidth;
      el.style.animation = 'fadeUp .5s both';
    }

    // ‚îÄ‚îÄ Symbol selection ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function selectSymbol(sym) {
      selectedSymbol = sym;
      document.getElementById('sym-x').classList.toggle('selected', sym === 'X');
      document.getElementById('sym-o').classList.toggle('selected', sym === 'O');
    }

    // ‚îÄ‚îÄ WebSocket ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function connect(onOpen) {
      if (ws) { ws.onclose = null; ws.close(); }
      const protocol = location.protocol === 'https:' ? 'wss' : 'ws';
      ws = new WebSocket(`${protocol}://${location.host}`);

      ws.onopen = () => {
        setConn(true);
        if (onOpen) onOpen();
      };

      ws.onmessage = (e) => handleMessage(JSON.parse(e.data));

      ws.onclose = () => {
        setConn(false);
        // Auto-reconnect only when in game
        if (roomCode) setTimeout(() => connect(() => {
          // Rejoin after reconnect
          send({ type: 'join', code: roomCode });
        }), 2000);
      };

      ws.onerror = () => ws.close();
    }

    function send(data) {
      if (ws && ws.readyState === WebSocket.OPEN) ws.send(JSON.stringify(data));
    }

    function setConn(ok) {
      const dot = document.getElementById('conn-dot');
      const lbl = document.getElementById('conn-label');
      if (!dot) return;
      dot.style.background = ok ? 'rgba(77,255,184,0.8)' : 'rgba(255,77,109,0.8)';
      if (lbl) lbl.textContent = ok ? 'LIVE' : 'RECONNECTING';
    }

    // ‚îÄ‚îÄ Message handler ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handleMessage(msg) {
      if (msg.type === 'created') {
        mySymbol = msg.symbol;
        roomCode = msg.code;
        document.getElementById('display-code').textContent = msg.code;
        document.getElementById('game-room-code').textContent = msg.code;
        const symEl = document.getElementById('assigned-symbol');
        if (symEl) {
          symEl.textContent = msg.symbol;
          symEl.style.color = msg.symbol === 'X' ? 'var(--x)' : 'var(--o)';
          symEl.style.textShadow = msg.symbol === 'X'
            ? '0 0 20px rgba(255,77,109,0.6)'
            : '0 0 20px rgba(77,255,184,0.6)';
        }
        showScreen('screen-waiting');
      }

      if (msg.type === 'joined') {
        mySymbol = msg.symbol;
        roomCode = msg.code;
        document.getElementById('game-room-code').textContent = msg.code;
        clearDisconnect();
        showScreen('screen-game');
      }

      if (msg.type === 'state') {
        gameState = msg.payload;
        clearError('game-error');
        // If we were waiting and both players now connected, go to game
        if (msg.payload.playerCount === 2) {
          if (document.getElementById('screen-waiting').classList.contains('active')) {
            showScreen('screen-game');
          }
          clearDisconnect();
        }
        renderGame();
      }

      if (msg.type === 'symbolUpdate') {
        mySymbol = msg.symbol;
      }

      if (msg.type === 'opponentLeft') {
        startDisconnectCountdown(msg.gracePeriod);
      }

      if (msg.type === 'roomClosed') {
        clearDisconnect();
        alert('Room closed: ' + msg.reason);
        leaveRoom();
      }

      if (msg.type === 'error') {
        // Route error to correct screen
        const screen = document.querySelector('.screen.active');
        const errId = screen ? screen.id.replace('screen-', '') + '-error' : 'game-error';
        showError(errId, msg.message);
      }
    }

    // ‚îÄ‚îÄ Create / Join ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function createRoom() {
      clearError('create-error');
      connect(() => send({ type: 'create' }));
    }

    function joinRoom() {
      clearError('join-error');
      const code = document.getElementById('join-code').value.trim().toUpperCase();
      if (code.length !== 4) { showError('join-error', 'Enter a 4-letter code'); return; }
      connect(() => {
        mySymbol = null; // will be assigned by server
        roomCode = code;
        send({ type: 'join', code });
      });
    }

    function leaveRoom() {
      if (ws) { ws.onclose = null; ws.close(); ws = null; }
      mySymbol = null; roomCode = null; gameState = null;
      clearDisconnect();
      document.getElementById('join-code').value = '';
      showScreen('screen-home');
    }

    // ‚îÄ‚îÄ Disconnect countdown ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function startDisconnectCountdown(seconds) {
      clearDisconnect();
      countdownVal = seconds;
      const bar = document.getElementById('disconnect-bar');
      bar.classList.add('visible');
      document.getElementById('countdown').textContent = countdownVal;
      countdownTimer = setInterval(() => {
        countdownVal--;
        document.getElementById('countdown').textContent = countdownVal;
        if (countdownVal <= 0) clearDisconnect();
      }, 1000);
      // Also reflect in status
      const st = document.getElementById('status');
      if (st) { st.className='status warn'; st.textContent='‚ö† OPPONENT DISCONNECTED'; }
    }

    function clearDisconnect() {
      if (countdownTimer) { clearInterval(countdownTimer); countdownTimer = null; }
      const bar = document.getElementById('disconnect-bar');
      if (bar) bar.classList.remove('visible');
    }

    // ‚îÄ‚îÄ Game rendering ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderGame() {
      if (!gameState) return;
      renderBoard();
      renderScores();
      renderStatus();
      renderTurnIndicator();
    }

    function renderBoard() {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      const g = gameState;
      const isOver = !!(g.winner || g.isDraw);
      const myTurn = g.currentPlayer === mySymbol && !isOver && g.opponentConnected;

      g.board.forEach((val, i) => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        if (val === 'X') cell.classList.add('x-cell', 'taken');
        if (val === 'O') cell.classList.add('o-cell', 'taken');
        if (isOver) cell.classList.add('over');
        if (g.winningLine && g.winningLine.includes(i)) cell.classList.add('winning');

        // Lock cell if it's not our turn
        if (!val && !isOver) {
          if (myTurn) {
            cell.addEventListener('click', () => send({ type: 'move', index: i }));
          } else {
            cell.classList.add('locked');
          }
        }

        if (val) {
          const span = document.createElement('span');
          span.className = 'cell-content';
          span.textContent = val;
          cell.appendChild(span);
        }

        grid.appendChild(cell);
      });
    }

    function renderScores() {
      const g = gameState;
      document.getElementById('score-x').textContent = g.scores.X;
      document.getElementById('score-o').textContent = g.scores.O;
      document.getElementById('score-draws').textContent = g.scores.draws;

      // Highlight MY card
      ['card-x','card-o','card-draw'].forEach(id => {
        document.getElementById(id).classList.remove('mine');
      });
      if (mySymbol === 'X') document.getElementById('card-x').classList.add('mine');
      if (mySymbol === 'O') document.getElementById('card-o').classList.add('mine');

      // Update labels to show YOU / OPPONENT
      const opp = mySymbol === 'X' ? 'O' : 'X';
      document.querySelector('#card-' + mySymbol?.toLowerCase() + ' .score-label').textContent = 'YOU';
      document.querySelector('#card-' + opp?.toLowerCase() + ' .score-label').textContent = 'OPPONENT';
    }

    function renderStatus() {
      const el = document.getElementById('status');
      const g = gameState;
      if (!g.opponentConnected) {
        el.className = 'status warn';
        el.textContent = '‚ö† WAITING FOR OPPONENT...';
        return;
      }
      el.className = 'status';
      if (g.winner) {
        el.classList.add('win');
        const youWon = g.winner === mySymbol;
        el.innerHTML = youWon
          ? `üèÜ YOU WIN!`
          : `<span class="pt ${g.winner.toLowerCase()}">${g.winner}</span> WINS`;
      } else if (g.isDraw) {
        el.classList.add('draw');
        el.textContent = '‚Äî DRAW ‚Äî';
      } else if (g.currentPlayer === mySymbol) {
        el.innerHTML = `YOUR TURN <span class="pt ${mySymbol.toLowerCase()}">(${mySymbol})</span>`;
      } else {
        el.innerHTML = `<span class="pt ${g.currentPlayer.toLowerCase()}">${g.currentPlayer}</span> IS THINKING...`;
      }
    }

    function renderTurnIndicator() {
      const g = gameState;
      document.getElementById('card-x').classList.remove('active-x','active-o');
      document.getElementById('card-o').classList.remove('active-x','active-o');
      // Remove old arrows
      document.querySelectorAll('.turn-arrow').forEach(el => el.remove());

      if (!g.winner && !g.isDraw && g.opponentConnected) {
        const activeCard = document.getElementById('card-' + g.currentPlayer.toLowerCase());
        activeCard.classList.add('active-' + g.currentPlayer.toLowerCase());
        const arrow = document.createElement('span');
        arrow.className = 'turn-arrow';
        arrow.textContent = '‚ñ∂';
        activeCard.appendChild(arrow);
      }
    }

    // ‚îÄ‚îÄ Error helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showError(id, msg) {
      const el = document.getElementById(id);
      if (el) { el.textContent = '‚ö† ' + msg.toUpperCase(); setTimeout(() => clearError(id), 3000); }
    }
    function clearError(id) {
      const el = document.getElementById(id);
      if (el) el.textContent = '';
    }
  </script>
</body>
</html>
